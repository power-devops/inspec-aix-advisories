# encoding: utf-8
# copyright: 2019, eNFence GmbH

title 'java_apr2019_advisory'

control 'CVE-2019-2684' do
  impact 0.59
  title 'CVE-2019-2684'
  desc 'An unspecified vulnerability in Oracle Java SE related to 
        the Java SE, Java SE Embedded RMI component could allow an 
        unauthenticated attacker to cause no confidentiality impact, high 
        integrity impact, and no availability impact.
  '
  tag 'java', 'jre', 'java8', 'java7', 'java71'
  tag :score, '5.9'
  ref 'http://aix.software.ibm.com/aix/efixes/security/java_apr2019_advisory.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc Java7_64.jre') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.64[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7_64.sdk') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.64[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7.jre') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.64[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7.sdk') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.64[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71_64.jre') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.44[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71_64.sdk') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.44[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71.jre') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.44[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71.sdk') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.44[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8_64.jre') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-2][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.53[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8_64.sdk') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-2][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.53[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8.jre') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-2][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.53[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8.sdk') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-2][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.53[0-4]:/) }
  end
end

