# encoding: utf-8
# copyright: 2019, eNFence GmbH

title 'java_apr2019_advisory'

control 'CVE-2019-2602' do
  impact 0.75
  title 'CVE-2019-2602'
  desc 'An unspecified vulnerability in Oracle Java SE related to 
        the Java SE, Java SE Embedded Libraries component could allow an 
        unauthenticated attacker to cause a denial of service resulting in a 
        high availability impact using unknown attack vectors.
  '
  tag 'java', 'jre', 'java8', 'java7', 'java71'
  tag :score, '7.5'
  ref 'http://aix.software.ibm.com/aix/efixes/security/java_apr2019_advisory.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc Java7_64.jre') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.64[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7_64.sdk') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.64[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7.jre') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.64[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7.sdk') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.64[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71_64.jre') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.44[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71_64.sdk') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.44[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71.jre') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.44[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71.sdk') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-3][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.44[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8_64.jre') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-2][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.53[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8_64.sdk') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-2][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.53[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8.jre') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-2][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.53[0-4]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8.sdk') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-2][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.53[0-4]:/) }
  end
end

