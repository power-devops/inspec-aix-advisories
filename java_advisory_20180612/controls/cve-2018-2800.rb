# encoding: utf-8
# copyright: 2018, eNFence GmbH

title 'java_advisory_20180612'

control 'CVE-2018-2800' do
  impact 0.42
  title 'CVE-2018-2800'
  desc 'An unspecified vulnerability in Oracle Java SE related to 
        the Java SE, JRockit RMI component could allow an unauthenticated 
        attacker to cause low confidentiality impact, low integrity impact, 
        and no availability impact.
  '
  tag 'java', 'jre', 'java8', 'java7', 'java71'
  tag :score, '4.2'
  ref 'http://aix.software.ibm.com/aix/efixes/security/java_apr2018_advisory.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc Java7_64.jre') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-5]/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-1]/) }
    its('stdout') { should_not match(/:7\.0\.0\.62[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7_64.sdk') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-5]/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-1]/) }
    its('stdout') { should_not match(/:7\.0\.0\.62[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7.jre') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-5]/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-1]/) }
    its('stdout') { should_not match(/:7\.0\.0\.62[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7.sdk') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-5]/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-1]/) }
    its('stdout') { should_not match(/:7\.0\.0\.62[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71_64.jre') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-3]/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-1]/) }
    its('stdout') { should_not match(/:7\.1\.0\.42[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71_64.sdk') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-3]/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-1]/) }
    its('stdout') { should_not match(/:7\.1\.0\.42[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71.jre') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-3]/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-1]/) }
    its('stdout') { should_not match(/:7\.1\.0\.42[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71.sdk') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-3]/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-1]/) }
    its('stdout') { should_not match(/:7\.1\.0\.42[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8_64.jre') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-4]/) }
    its('stdout') { should_not match(/:8\.0\.0\.50/) }
    its('stdout') { should_not match(/:8\.0\.0\.51[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8_64.sdk') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-4]/) }
    its('stdout') { should_not match(/:8\.0\.0\.50/) }
    its('stdout') { should_not match(/:8\.0\.0\.51[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8.jre') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-4]/) }
    its('stdout') { should_not match(/:8\.0\.0\.50/) }
    its('stdout') { should_not match(/:8\.0\.0\.51[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8.sdk') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-4]/) }
    its('stdout') { should_not match(/:8\.0\.0\.50/) }
    its('stdout') { should_not match(/:8\.0\.0\.51[0-4]/) }
  end
end

