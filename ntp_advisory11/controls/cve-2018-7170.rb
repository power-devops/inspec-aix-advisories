# encoding: utf-8
# copyright: 2017, The Authors

title 'ntp_advisory11'

control 'CVE-2018-7170' do
  impact 0.31
  title 'CVE-2018-7170'
  desc 'NTP could allow a remote authenticated attacker to bypass 
        security restrictions, caused by a Sybil attack. By creating many 
        ephemeral associations, an attacker could exploit this vulnerability 
        to win the clock selection of ntpd and modify a victims clock. 
  '

  tag 'ntp', 'aix', 'aix53', 'aix61', 'aix71', 'aix72'
  tag :score, '3.1'
  ref 'http://aix.software.ibm.com/aix/efixes/security/ntp_advisory11.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc ntp.rte') do
    its('stdout') { should_not match(/:7\.4\.2\.810[0-9]:/) }
  end

  if command('/usr/bin/lslpp -Lqc ntp.rte').stdout.match(/:7\.4\.2\.8110:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10280s3b/) }
    end
  end
end
