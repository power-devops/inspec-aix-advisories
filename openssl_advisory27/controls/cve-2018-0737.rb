# encoding: utf-8
# copyright: 2017, The Authors

title 'openssl_advisory26'

control 'CVE-2018-0737' do
  impact 0.33
  title 'Vulnerability in OpenSSL affects AIX (CVE-2018-0737)'
  desc 'Constructed ASN.1 types with a recursive definition (such
        as can be found in PKCS7) could eventually exceed the stack given 
        malicious input with excessive recursion. This could result in a 
        Denial Of Service attack.
  '

  tag 'openssl'
  tag :score, '3.3'
  ref 'https://aix.software.ibm.com/aix/efixes/security/openssl_advisory27.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc openssl.base') do
    its('stdout') { should_not match(/:0\.[0-9]\./) }
    its('stdout') { should_not match(/:1\.0\.[01]\./) }
    its('stdout') { should_not match(/:1\.0\.2\.0/) }
    its('stdout') { should_not match(/:1\.0\.2\.1[0-4]/) }
  end

  describe command('/usr/bin/lslpp -Lqc openssl.base') do
    its('stdout') { should_not match(/:20\.0\./) }
    its('stdout') { should_not match(/:20\.1[0-2]\./) }
    its('stdout') { should_not match(/:20\.13\.0/) }
    its('stdout') { should_not match(/:20\.13\.10[01]/) }
    its('stdout') { should_not match(/:20\.13\.102\.0/) }
    its('stdout') { should_not match(/:20\.13\.102\.1[0-4]/) }
  end
end
