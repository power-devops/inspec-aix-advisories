# encoding: utf-8
# copyright: 2017, The Authors

title 'openssh_advisory13'

control 'CVE-2019-6111' do
  impact 0.53
  title 'CVE-2019-6111'
  desc 'OpenSSH could allow a remote attacker to overwrite 
        arbitrary files on the system, caused by missing received object 
        name validation by the scp client. The scp implementation accepts 
        arbitrary files sent by the server and a man-in-the-middle attacker 
        could exploit this vulnerability to overwrite unrelated files.
  '

  tag 'openssh'
  tag 'aix', 'aix53', 'aix61', 'aix71', 'aix72'
  tag 'vios', 'vios2', 'vios3'
  tag :score, '5.3'
  ref 'http://aix.software.ibm.com/aix/efixes/security/openssh_advisory13.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc openssh.base.client') do
    its('stdout') { should_not match(/:4\.[0-9]\./) }
    its('stdout') { should_not match(/:5\.[0-9]\./) }
    its('stdout') { should_not match(/:6\.[0-9]\./) }
    its('stdout') { should_not match(/:7\.[0-4]\./) }
    its('stdout') { should_not match(/:7\.5\.[0-9]\./) }
    its('stdout') { should_not match(/:7\.5\.[1-9][0-9]\./) }
    its('stdout') { should_not match(/:7\.5\.10[01]\./) }
    its('stdout') { should_not match(/:7\.5\.102\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.[1-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.[1-9][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.1[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.1600:/) }
  end

  describe command('/usr/bin/lslpp -Lqc openssh.base.server') do
    its('stdout') { should_not match(/:4\.[0-9]\./) }
    its('stdout') { should_not match(/:5\.[0-9]\./) }
    its('stdout') { should_not match(/:6\.[0-9]\./) }
    its('stdout') { should_not match(/:7\.[0-4]\./) }
    its('stdout') { should_not match(/:7\.5\.[0-9]\./) }
    its('stdout') { should_not match(/:7\.5\.[1-9][0-9]\./) }
    its('stdout') { should_not match(/:7\.5\.10[01]\./) }
    its('stdout') { should_not match(/:7\.5\.102\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.[1-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.[1-9][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.1[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.1600:/) }
  end
end
