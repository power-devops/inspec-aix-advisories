# encoding: utf-8
# copyright: 2017, The Authors

title 'openssh_advisory13'

control 'CVE-2018-20685' do
  impact 0.75
  title 'CVE-2018-20685'
  desc 'In OpenSSH 7.9, scp.c in the scp client allows remote 
        SSH servers to bypass intended access restrictions via the 
        filename of . or an empty filename. The impact is modifying 
        the permissions of the target directory on the client side.
  '

  tag 'openssh'
  tag 'aix', 'aix53', 'aix61', 'aix71', 'aix72'
  tag 'vios', 'vios2', 'vios3'
  tag :score, '7.5'
  ref 'http://aix.software.ibm.com/aix/efixes/security/openssh_advisory13.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc openssh.base.client') do
    its('stdout') { should_not match(/:4\.[0-9]\./) }
    its('stdout') { should_not match(/:5\.[0-9]\./) }
    its('stdout') { should_not match(/:6\.[0-9]\./) }
    its('stdout') { should_not match(/:7\.[0-4]\./) }
    its('stdout') { should_not match(/:7\.5\.[0-9]\./) }
    its('stdout') { should_not match(/:7\.5\.[1-9][0-9]\./) }
    its('stdout') { should_not match(/:7\.5\.10[01]\./) }
    its('stdout') { should_not match(/:7\.5\.102\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.[1-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.[1-9][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.1[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.1600:/) }
  end

  describe command('/usr/bin/lslpp -Lqc openssh.base.server') do
    its('stdout') { should_not match(/:4\.[0-9]\./) }
    its('stdout') { should_not match(/:5\.[0-9]\./) }
    its('stdout') { should_not match(/:6\.[0-9]\./) }
    its('stdout') { should_not match(/:7\.[0-4]\./) }
    its('stdout') { should_not match(/:7\.5\.[0-9]\./) }
    its('stdout') { should_not match(/:7\.5\.[1-9][0-9]\./) }
    its('stdout') { should_not match(/:7\.5\.10[01]\./) }
    its('stdout') { should_not match(/:7\.5\.102\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.[1-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.[1-9][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.1[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.5\.102\.1600:/) }
  end
end
