# encoding: utf-8
# copyright: 2019, eNFence GmbH

title 'java_jul2019_advisory'

control 'CVE-2019-11771' do
  impact 0.84
  title 'CVE-2019-11771'
  desc 'Eclipse OpenJ9 could allow a local attacker to gain elevated
        privileges on the system, caused by the inclusion of unused RPATHS in
        AIX builds. An attacker could exploit this vulnerability to inject
        code and gain elevated privileges on the system.
  '
  tag 'java', 'jre', 'java8', 'java7', 'java71'
  tag :score, '8.4'
  ref 'http://aix.software.ibm.com/aix/efixes/security/java_july2019_advisory.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc Java7_64.jre') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-4][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7_64.sdk') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-4][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7.jre') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-4][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java7.sdk') do
    its('stdout') { should_not match(/:7\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.[0-5][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.0\.0\.6[0-4][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71_64.jre') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-4][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71_64.sdk') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-4][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71.jre') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-3][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java71.sdk') do
    its('stdout') { should_not match(/:7\.1\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.[0-3][0-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.0\.4[0-4][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8_64.jre') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-3][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8_64.sdk') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-3][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8.jre') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-3][0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc Java8.sdk') do
    its('stdout') { should_not match(/:8\.0\.0\.[0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.[0-4][0-9][0-9]:/) }
    its('stdout') { should_not match(/:8\.0\.0\.5[0-3][0-9]:/) }
  end
end

