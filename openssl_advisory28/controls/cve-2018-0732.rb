# encoding: utf-8
# copyright: 2017, The Authors

title 'openssl_advisory28'

control 'CVE-2018-0732' do
  impact 0.53
  title 'There is a vulnerability in OpenSSL used by AIX.'
  desc 'OpenSSL is vulnerable to a denial of service, caused by the
        sending of a very large prime value to the client by a malicious server
        during key agreement in a TLS handshake. By spending an unreasonably
        long period of time generating a key for this prime, a remote attacker
        could exploit this vulnerability to cause the client to hang.
  '

  tag 'openssl'
  tag :score, '5.3'
  ref 'https://aix.software.ibm.com/aix/efixes/security/openssl_advisory28.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc openssl.base') do
    its('stdout') { should_not match(/:1\.0\.2\.[5-9][0-9][0-9]:/) }
    its('stdout') { should_not match(/:1\.0\.2\.1[0-4][0-9]/) }
  end

  describe command('/usr/bin/lslpp -Lqc openssl.base') do
    its('stdout') { should_not match(/:20\.13\.102\.1[0-4][0-9]/) }
  end

  if command('/usr/bin/lslpp -Lqc openssl.base').stdout.match(/:1\.0\.2\.1500:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/102oa_ifix/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc openssl.base').stdout.match(/:20\.13\.102\.1500:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/fips_102oa/) }
    end
  end
end
