# encoding: utf-8
# copyright: 2018, eNFence GmbH

title 'solaris_advisory'

control 'CVE-2017-3623' do
  impact 1.0
  title 'Vulnerability in Oracle Solaris affects AIX (CVE-2017-3623)'
  desc 'An unspecified vulnerability in Oracle Sun Systems related 
        to the Solaris Kernel RPC component could allow an unauthenticated 
        attacker to take control of the system.
  '

  tag 'aix', 'aix53', 'aix61', 'aix71', 'aix72'
  tag 'vios', 'vios2'
  tag :score, '10.0'
  ref 'ftp://aix.software.ibm.com/aix/efixes/security/solaris_advisory.asc'

  only_if do
    os.aix?
  end

  describe command('/usr/bin/lslpp -Lqc bos.net.tcp.client') do
    its('stdout') { should_not match(/:5\.3\.[0-9]\./) }
    its('stdout') { should_not match(/:5\.3\.1[01]\./) }
    its('stdout') { should_not match(/:5\.3\.12\.[0-9]:/) }
    its('stdout') { should_not match(/:6\.1\.[0-8]\./) }
    its('stdout') { should_not match(/:6\.1\.9\.[0-9]:/) }
    its('stdout') { should_not match(/:6\.1\.9\.[0-9][0-9]:/) }
    its('stdout') { should_not match(/:6\.1\.9\.[1-2][0-9][0-9]:/) }
    its('stdout') { should_not match(/:6\.1\.9\.30[1-9]:/) }
    its('stdout') { should_not match(/:6\.1\.9\.31[0-47-9]:/) }
    its('stdout') { should_not match(/:6\.1\.9\.3[2-9][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.[0-3]\./) }
    its('stdout') { should_not match(/:7\.1\.4\.[0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.4\.[12][0-9]:/) }
    its('stdout') { should_not match(/:7\.1\.4\.30:/) }
    its('stdout') { should_not match(/:7\.1\.5\.[1-9]:/) }
    its('stdout') { should_not match(/:7\.1\.5\.1[0-47-9]:/) }
    its('stdout') { should_not match(/:7\.1\.5\.2[0-9]:/) }
  end

  describe command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core') do
    its('stdout') { should_not match(/:7\.2\.0\.[0-2]:/) }
    its('stdout') { should_not match(/:7\.2\.1\.0:/) }
    its('stdout') { should_not match(/:7\.2\.2\.[1-9]:/) }
    its('stdout') { should_not match(/:7\.2\.2\.1[0-4]:/) }
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:5\.3\.12\.10:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10554s9a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:6\.1\.9\.300:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10134sAa/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:6\.1\.9\.315:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10134sBa/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:6\.1\.9\.316:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10134sBb/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:6\.1\.9\.400:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10134sCa/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:7\.1\.4\.31:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10275s4a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:7\.1\.4\.32:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10275s5a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:7\.1\.4\.33:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10275s6a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:7\.1\.5\.0:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10132s1a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:7\.1\.5\.15:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10132s2a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:7\.1\.5\.16:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10132s2b/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client').stdout.match(/:7\.1\.5\.30:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10132s3a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.0\.3:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10553s4a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.0\.4:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10553s5a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.0\.5:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10553s6a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.1\.1:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10552s2a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.1\.2:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10552s3a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.1\.3:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10552s4a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.2\.0:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10130s0a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.2\.15:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10130s2a/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.2\.16:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ10130s2b/) }
    end
  end

  if command('/usr/bin/lslpp -Lqc bos.net.tcp.client_core').stdout.match(/:7\.2\.3\.0:/)
    describe command('/usr/sbin/emgr -l') do
      its('stdout') { should match(/IJ09805s0a/) }
    end
  end
end
